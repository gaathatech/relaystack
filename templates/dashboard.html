{% extends "base.html" %}

{% block title %}Dashboard - Nexora{% endblock %}

{% block content %}
<div class="page-title"><i class="fas fa-tachometer-alt"></i> Dashboard</div>

<div class="row">
    <div class="col-md-3">
        <div class="card metric-card">
            <div class="metric-value" id="messagesSent">-</div>
            <div class="metric-label">Messages Sent</div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card metric-card">
            <div class="metric-value" id="chatConversations">-</div>
            <div class="metric-label">Chat Conversations</div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card metric-card">
            <div class="metric-value" id="chatbotAccuracy">-</div>
            <div class="metric-label">Chatbot Accuracy</div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card metric-card">
            <div class="metric-value" id="successRate">-</div>
            <div class="metric-label">Send Success Rate</div>
        </div>
    </div>
</div>

<div class="row mt-5">
    <div class="col-md-6">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title"><i class="fas fa-fire"></i> Quick Actions</h5>
                <div class="list-group">
                    <a href="/chatbot" class="list-group-item list-group-item-action">
                        <i class="fas fa-robot"></i> Open Chatbot</a>
                    <a href="/campaigns" class="list-group-item list-group-item-action">
                        <i class="fas fa-bullhorn"></i> Create Campaign</a>
                    <a href="/contacts" class="list-group-item list-group-item-action">
                        <i class="fas fa-address-book"></i> Manage Contacts</a>
                    <a href="/analytics" class="list-group-item list-group-item-action">
                        <i class="fas fa-chart-bar"></i> View Analytics</a>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title"><i class="fas fa-info-circle"></i> System Info</h5>
                <table class="table table-sm mb-0">
                    <tr><td><strong>Service Status:</strong></td><td><span class="badge bg-success">Online</span></td></tr>
                    <tr><td><strong>Service Name:</strong></td><td>Nexora Marketing Platform</td></tr>
                    <tr><td><strong>Period:</strong></td><td>Last 30 Days</td></tr>
                    <tr><td><strong>Last Update:</strong></td><td id="lastUpdate">Now</td></tr>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
function loadDashboardStats() {
    axios.get('/api/analytics/summary?days=30')
        .then(res => {
            const summary = res.data.summary;
            document.getElementById('messagesSent').textContent = summary?.marketing?.total_messages_sent || 0;
            document.getElementById('chatConversations').textContent = summary?.chatbot?.total_chats || 0;
            document.getElementById('chatbotAccuracy').textContent = 
                ((summary?.chatbot?.answer_rate || 0) * 100).toFixed(1) + '%';
            document.getElementById('successRate').textContent = 
                ((summary?.marketing?.success_rate || 0)).toFixed(1) + '%';
        })
        .catch(err => console.error('Error loading stats:', err));
}

loadDashboardStats();
setInterval(loadDashboardStats, 30000); // Refresh every 30 seconds
</script>
{% endblock %}
